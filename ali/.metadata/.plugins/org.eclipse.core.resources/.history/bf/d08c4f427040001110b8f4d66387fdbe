import Variables
import Clientes
import Productos
import Facturas
from datetime import date
import sys
from PyQt4 import QtGui
from principal import Ui_Principal

from listadoClientes import Ui_ListadoClientes
from detalleClientes import Ui_DetalleClientes
from listadoProductos import Ui_ListadoProductos
from detalleProductos import Ui_DetalleProductos
from formularioFactura import Ui_FormularioFactura
from listadoFacturasDiarias import Ui_ListadoFacturasDiarias
'''
Created on 30/12/2011

@author: kaos
'''

class formularioPrincipal(QtGui.QMainWindow):
    def __init__(self,parent=None):
        QtGui.QWidget.__init__(self,parent)
        self.ui=Ui_Principal()
        self.ui.setupUi(self)
    
    def lanzarClientes(self):
        self.close()
        self.ui=formularioSeleccionCliente()
        self.ui.show()
        
    def lanzarProductos(self):
        self.close()
        self.ui=formularioSeleccionProducto()
        self.ui.show()
        
    def lanzarDiaria(self):
        self.close()
        self.ui=formularioFacturasDiarias()
        self.ui.show()
        
    def lanzarMensual(self):
        
        c=0
    
class formularioSeleccionCliente(QtGui.QMainWindow):
    def __init__(self,parent=None):
        QtGui.QWidget.__init__(self,parent)
        self.ui=Ui_ListadoClientes()
        self.ui.setupUi(self)
    
    def lanzarDetalleCliente(self):
        count = self.ui.listWidget.count()
        
        itemseleccionado=0
        for i in range(count):
            item=self.ui.listWidget.item(i)
            if(self.ui.listWidget.isItemSelected(item)):
                itemseleccionado=item
        
        if(itemseleccionado!=0):
            nombre=itemseleccionado.text().toUtf8().data()
            print ("El item seleccionado es %s",nombre)
            if(nombre=="Nuevo Cliente"):
                Variables.Variables.cliente=Clientes.Clientes("","","","","","","")
            else:
                Variables.Variables.cliente=Variables.Variables.getCliente(nombre)
            self.close()
            self.ui=formularioDetalleCliente()
            self.ui.show()
           
    def lanzarPrincipal(self):
        self.close()
        self.ui=formularioPrincipal()
        self.ui.show()
 
class formularioDetalleCliente(QtGui.QMainWindow):
    def __init__(self,parent=None):
        QtGui.QWidget.__init__(self,parent)
        self.ui=Ui_DetalleClientes()
        self.ui.setupUi(self)
    
    def borrarCliente(self):
        self.close()
        Variables.Variables.eliminarCliente(Variables.Variables.cliente)
        self.ui=formularioSeleccionCliente()
        self.ui.show()
    
    def lanzarListarClientes(self):
        self.close()
        self.ui=formularioSeleccionCliente()
        self.ui.show()
        
    def lanzarModificarCliente(self):
        self.close()
        Variables.Variables.cliente.nombre=str(self.ui.lineaNombre.text())
        Variables.Variables.cliente.detalles=str(self.ui.lineaDetalle.text())
        Variables.Variables.cliente.ciudad=str(self.ui.lineaCIudad.text())
        Variables.Variables.cliente.direccion=str(self.ui.lineaDireccion.text())
        Variables.Variables.cliente.cif=str(self.ui.lineaDNI.text())
        Variables.Variables.cliente.pais=str(self.ui.lineaPais.text())
        Variables.Variables.modificarCliente(Variables.Variables.cliente)
        self.ui=formularioSeleccionCliente()
        self.ui.show()
        
class formularioSeleccionProducto(QtGui.QMainWindow):
    def __init__(self,parent=None):
        QtGui.QWidget.__init__(self,parent)
        self.ui=Ui_ListadoProductos()
        self.ui.setupUi(self)
    
    def lanzarPrincipal(self):
        self.close()
        self.ui=formularioPrincipal()
        self.ui.show()
    
    def lanzarDetalleProductos(self):
        count = self.ui.listWidget.count()
        
        itemseleccionado=0
        for i in range(count):
            item=self.ui.listWidget.item(i)
            if(self.ui.listWidget.isItemSelected(item)):
                itemseleccionado=item
        
        if(itemseleccionado!=0):
            nombre=itemseleccionado.text().toUtf8().data()
            print ("El item seleccionado es %s",nombre)
            if(nombre=="Nuevo Producto"):
                Variables.Variables.producto=Productos.Productos("","","","","")
            else:
                Variables.Variables.producto=Variables.Variables.getProducto(nombre)
            self.close()
            self.ui=formularioDetalleProducto()
            self.ui.show()

class formularioDetalleProducto(QtGui.QMainWindow):
    def __init__(self,parent=None):
        QtGui.QWidget.__init__(self,parent)
        self.ui=Ui_DetalleProductos()
        self.ui.setupUi(self)
    
    def borrarProductos(self):
        self.close()
        Variables.Variables.eliminarProducto(Variables.Variables.producto)
        self.ui=formularioSeleccionProducto()
        self.ui.show()
    
    def lanzarListarProductos(self):
        self.close()
        self.ui=formularioSeleccionProducto()
        self.ui.show()
        
    def lanzarModificarProductos(self):
        self.close()
        Variables.Variables.producto.nombre=str(self.ui.lineaNombre.text())
        Variables.Variables.producto.detalle=str(self.ui.lineaDetalle.text())
        Variables.Variables.producto.precio=str(self.ui.lineaPrecio.text())
        if(self.ui.radioButton.isChecked()):
            Variables.Variables.producto.unidades=1
        else:
            Variables.Variables.producto.unidades=0
        Variables.Variables.modificarProducto(Variables.Variables.producto)
        self.ui=formularioSeleccionProducto()
        self.ui.show()
        
class formularioFacturasDiarias(QtGui.QMainWindow):
    def __init__(self,parent=None):
        QtGui.QWidget.__init__(self,parent)
        self.ui=Ui_ListadoFacturasDiarias()
        self.ui.setupUi(self)
    
    def lanzarPrincipal(self):  
        self.close()
        self.ui=formularioPrincipal()
        self.ui.show()
    
    def lanzarImprimir(self):
        a=0
    def lanzarDetallesFactura(self):
        
        self.close()
        count = self.ui.tableWidget.rowCount()

        
        itemseleccionado=0
      
        for i in range(count):
            item = self.ui.tableWidget.item(i,1)
            if(self.ui.tableWidget.isItemSelected(item)):
                itemseleccionado=item


        print itemseleccionado.text().toUtf8()
    
        Variables.Variables.factura=Variables.Variables.getFactura(itemseleccionado.text().toUtf8().toLong()[0])
        self.ui=formularioFactura()
        
        self.ui.show()
        
        
    def lanzarNuevaFactura(self):
        self.ui.close()
        Variables.Variables.factura=Facturas.Facturas("","","","")
        self.ui=formularioFactura()
        self.ui.show()
        

class formularioFactura(QtGui.QMainWindow):
    def __init__(self,parent=None):
        QtGui.QWidget.__init__(self,parent)
        self.ui=Ui_FormularioFactura()
        self.ui.setupUi(self)   
    
    def lazarFinFactura(self):
        a=0
    
    def lazarSeleccionarCliente(self):
        a=0
        
if __name__ == '__main__':
    
    Variables.Variables()
    desde=date(2011,12,31)
    hasta=date(2011,12,31)
    facturas1=Variables.Variables.getFacturas("SIDI")
    facturas2=Variables.Variables.getFacturasEntre("SIDI",desde,hasta)
    nombres=Variables.Variables.getNombresClientes()
    app = QtGui.QApplication(sys.argv)
    myapp = formularioPrincipal()
    myapp.show()
    sys.exit(app.exec_())

    
    